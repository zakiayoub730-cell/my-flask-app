<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sensi Reseller Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- GATEWAY -->
    <div id="view-gateway" class="view-gateway">
        <div class="gateway-box">
            <div class="gateway-title">SECURITY VALIDATION</div>
            <div class="gateway-spinner"></div>
            <div id="gateway-text" class="gateway-text">Checking browser...</div>
            <div class="gateway-progress-wrap">
                <div id="gateway-progress" class="gateway-progress-bar"></div>
            </div>
        </div>
    </div>

    <!-- BUBBLES BG -->
    <div id="bubbles-bg" class="bubbles-bg hidden"></div>

    <!-- LOGIN -->
    <div id="view-login" class="view-login hidden">
        <div class="login-card" id="login-card">
            <h1 class="login-title">KEY DASHBOARD</h1>
            <div id="login-error" class="login-error hidden">
                <i class="fa-solid fa-triangle-exclamation"></i>
                <span id="login-error-text"></span>
            </div>
            <label class="form-label">Username</label>
            <div class="input-group">
                <i class="fa-solid fa-user input-icon"></i>
                <input type="text" id="login-user" placeholder="Enter your username" onpaste="return false;" autocomplete="off">
            </div>
            <label class="form-label">Password</label>
            <div class="input-group">
                <i class="fa-solid fa-lock input-icon"></i>
                <input type="password" id="login-pass" placeholder="Enter your password" onpaste="return false;" autocomplete="off">
                <i class="fa-solid fa-eye toggle-pass" id="toggle-pass" onclick="togglePassword()"></i>
            </div>
            <button class="btn-login" id="btn-login" onclick="attemptLogin()">
                <span id="btn-login-text">Sign In</span>
                <i class="fa-solid fa-arrow-right" id="btn-login-arrow"></i>
                <div class="spinner" id="login-spinner"></div>
            </button>
            <div class="login-footer">SENSI STORE</div>
        </div>
    </div>
    <div class="login-footer">SENSI STORE</div>

<!-- Contact Section -->
<div class="contact">
    <div class="contact-title">Contact Support</div>

    <div class="icons">
        <a href="https://wa.me/212699619002" target="_blank" class="whatsapp">
            <i class="fab fa-whatsapp"></i>
        </a>

        <a href="https://t.me/Owner_Sensi" target="_blank" class="telegram">
            <i class="fab fa-telegram"></i>
        </a>
    </div>
</div>

    <!-- SECURITY SCAN -->
    <div id="view-security-scan" class="view-security-scan hidden">
        <div class="scan-icon"><i class="fa-solid fa-fingerprint"></i></div>
        <div class="scan-title">SECURITY SCAN</div>
        <div id="scan-text" class="scan-text">Analyzing device fingerprint...</div>
        <div class="scan-progress-wrap">
            <div id="scan-progress" class="scan-progress-bar"></div>
        </div>
    </div>

    <!-- FINGERPRINT VERIFICATION -->
    <div id="view-fingerprint-verify" class="view-security-scan hidden">
        <div class="scan-icon fingerprint-pulse"><i class="fa-solid fa-fingerprint"></i></div>
        <div class="scan-title">SECURITY SCAN</div>
        <div id="fp-verify-text" class="scan-text">Scanning device fingerprint...</div>
        <div class="fp-checks" id="fp-checks"></div>
        <div class="scan-progress-wrap" style="margin-top:20px;">
            <div id="fp-verify-progress" class="scan-progress-bar"></div>
        </div>
    </div>

    <!-- POST-LOGIN VERIFICATION -->
    <div id="view-post-login-verify" class="view-security-scan hidden">
        <div class="scan-icon"><i class="fa-solid fa-shield-halved"></i></div>
        <div class="scan-title">SESSION VERIFICATION</div>
        <div id="post-login-text" class="scan-text">Securing your session...</div>
        <div class="fp-checks" id="post-login-checks"></div>
        <div class="scan-progress-wrap" style="margin-top:20px;">
            <div id="post-login-progress" class="scan-progress-bar"></div>
        </div>
    </div>

    <!-- BAN SCREEN -->
    <div id="view-banned" class="view-banned hidden">
        <div class="ban-icon"><i class="fa-solid fa-ban"></i></div>
        <div class="ban-title">BANNED</div>
        <div class="ban-text">IP BANNED - SECURITY VIOLATION</div>
        <div class="ban-text">Your IP has been permanently blocked</div>
        <div style="margin-top: 30px; padding: 15px 20px; background: rgba(239, 68, 68, 0.1); border: 1px solid #ef4444; border-radius: 8px; display: flex; align-items: center; justify-content: space-between; gap: 15px; max-width: 300px; margin-left: auto; margin-right: auto;">
            <div style="flex: 1;">
                <div style="font-size: 12px; color: #a0aec0; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 5px;">Blocked IP Address</div>
                <div id="banned-ip-display" style="font-family: monospace; font-size: 14px; color: #fff; word-break: break-all;">-</div>
            </div>
            <button onclick="copyBannedIP()" style="background: none; border: none; padding: 8px; cursor: pointer; color: #60a5fa; font-size: 16px;" title="Copy IP">
                <i class="fa-solid fa-copy"></i>
            </button>
        </div>
    </div>

    <!-- ADMIN LOGIN -->
    <div id="view-admin-login" class="view-login hidden">
        <div class="login-card" id="admin-login-card">
            <h1 class="login-title">ADMIN CONTROL</h1>
            <div id="admin-login-error" class="login-error hidden">
                <i class="fa-solid fa-triangle-exclamation"></i>
                <span id="admin-login-error-text"></span>
            </div>
            <label class="form-label">Login data</label>
            <div class="input-group">
                <i class="fa-solid fa-lock input-icon"></i>
                <input type="password" id="admin-pass-input" placeholder="password" onpaste="return false;" autocomplete="off">
            </div>
            <button class="btn-login" onclick="adminLogin()" style="background: linear-gradient(135deg, #ef4444, #f87171);">
                <span>Sign In</span>
                <i class="fa-solid fa-arrow-right"></i>
            </button>
            <div class="login-footer">MG AMAR</div>
        </div>
    </div>

    <!-- ADMIN 2FA CODE INPUT -->
    <div id="view-admin-2fa-code" class="view-login hidden">
        <div class="login-card" id="admin-2fa-card">
            <h1 class="login-title">2FA VERIFICATION</h1>
            <div id="admin-2fa-error" class="login-error hidden">
                <i class="fa-solid fa-triangle-exclamation"></i>
                <span id="admin-2fa-error-text"></span>
            </div>
            <div style="text-align: center; margin-bottom: 20px;">
                <div style="width: 64px; height: 64px; margin: 0 auto 16px; background: rgba(139, 92, 246, 0.15); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                    <i class="fa-solid fa-shield-halved" style="font-size: 28px; color: #a78bfa;"></i>
                </div>
                <p style="color: #a0aec0; font-size: 14px; line-height: 1.6;">
                    Password verified. Enter your 2FA code to continue.
                </p>
            </div>
            <label class="form-label">2FA Code</label>
            <div class="input-group">
                <i class="fa-solid fa-key input-icon"></i>
                <input type="password" id="admin-2fa-input" placeholder="Enter 2FA code" onpaste="return false;" autocomplete="off" maxlength="10">
            </div>
            <button class="btn-login" id="btn-admin-2fa" onclick="submitAdmin2FA()" style="background: linear-gradient(135deg, #ef4444, #f87171);">
                <span id="btn-admin-2fa-text">Verify</span>
                <i class="fa-solid fa-arrow-right" id="btn-admin-2fa-arrow"></i>
                <div class="spinner" id="admin-2fa-spinner"></div>
            </button>
            <button class="btn-login" onclick="cancelAdmin2FA()" style="margin-top: 10px; background: linear-gradient(135deg, #6b7280, #9ca3af); width: 100%;">
                <span>Cancel</span>
                <i class="fa-solid fa-times"></i>
            </button>
            <div class="login-footer">MG AMAR</div>
        </div>
    </div>

    <!-- DASHBOARD -->
    <div id="view-dashboard" class="view-dashboard hidden">
        <div class="dash-header">
            <div class="header-left">
                <div class="header-avatar"><i class="fa-solid fa-crown"></i></div>
                <span class="header-username" id="dash-username">User</span>
            </div>
            <div class="header-right">
                <div class="balance-badge">
                    <i class="fa-solid fa-wallet"></i>
                    <span id="dash-balance">$0.00</span>
                </div>
                <div class="menu-toggle" onclick="toggleSidebar()">
                    <i class="fa-solid fa-bars"></i>
                </div>
            </div>
        </div>

        <div id="sidebar-overlay" class="sidebar-overlay" onclick="toggleSidebar()"></div>
        <div id="sidebar" class="sidebar">
            <div class="sidebar-header">
                <h3><i class="fa-solid fa-grid-2"></i> Menu</h3>
                <div class="sidebar-close" onclick="toggleSidebar()"><i class="fa-solid fa-xmark"></i></div>
            </div>
            <div class="sidebar-nav">
                <a class="nav-item active" onclick="switchTab('tab-generator', this)">
                    <i class="fa-solid fa-key"></i> Generate Keys
                </a>
                <a class="nav-item" onclick="switchTab('tab-statistics', this)">
                    <i class="fa-solid fa-chart-line"></i> Statistics
                </a>
                <a class="nav-item" onclick="switchTab('tab-history', this)">
                    <i class="fa-solid fa-clock-rotate-left"></i> Keys History
                </a>
                <a class="nav-item" onclick="switchTab('tab-transactions', this)">
                    <i class="fa-solid fa-money-bill-transfer"></i> Transactions
                </a>
            </div>
        </div>

        <div class="dash-content">
            <!-- KEY GENERATOR -->
            <div id="tab-generator" class="tab-content active">
                <div class="gen-card">
                    <div class="gen-title">Key Generator</div>
                    <div class="gen-label"><i class="fa-solid fa-box-open"></i> PRODUCT TYPE :</div>
                    <select id="gen-product" class="gen-select" onchange="updateValidityDropdown()"></select>
                    <div class="gen-label"><i class="fa-solid fa-hourglass-half"></i> VALIDITY :</div>
                    <select id="gen-validity" class="gen-select"></select>
                    <div class="gen-label"><i class="fa-solid fa-layer-group"></i> QUANTITY :</div>
                    <div class="quantity-wrap">
                        <button class="qty-btn minus" onclick="changeQty(-1)">-</button>
                        <div class="qty-display" id="qty-display">1</div>
                        <button class="qty-btn plus" onclick="changeQty(1)">+</button>
                    </div>
                    <button class="btn-generate" onclick="generateKeys()">
                        <i class="fa-solid fa-bolt"></i> GENERATE KEYS
                    </button>
                    <div id="keys-result" class="keys-result hidden"></div>
                </div>
            </div>

            <!-- STATISTICS -->
            <div id="tab-statistics" class="tab-content">
                <div class="stat-hero">
                    <div class="stat-hero-left">
                        <div class="stat-hero-icon"><i class="fa-solid fa-chart-line"></i></div>
                        <div class="stat-hero-label">ALL TIME TOTAL SOLD :</div>
                    </div>
                    <div class="stat-hero-value" id="stat-total">0</div>
                </div>
                <div class="stat-section">
                    <div class="stat-section-header">
                        <i class="fa-solid fa-clock-rotate-left"></i>
                        <h3>All Time Keys Breakdown</h3>
                    </div>
                    <table class="data-table">
                        <thead><tr><th style="text-align:center;">PRODUCT</th><th style="text-align:center;">TOTAL SOLD</th></tr></thead>
                        <tbody id="stat-breakdown"></tbody>
                    </table>
                </div>
                <div class="export-btns" style="margin-top:20px;">
                    <button class="btn-export pdf" onclick="exportPDF()" style="width:100%;">
                        <i class="fa-solid fa-file-pdf"></i> Download PDF
                    </button>
                </div>
            </div>

            <!-- HISTORY -->
            <div id="tab-history" class="tab-content">
                <div class="stat-section-header" style="justify-content:center; margin-bottom:16px;">
                    <i class="fa-solid fa-clock-rotate-left" style="color:#a78bfa; font-size:22px;"></i>
                    <h3 style="color:#a78bfa; font-size:18px; font-weight:700;">Key History</h3>
                </div>
                <div class="table-responsive">
                    <table class="data-table">
                        <thead><tr><th style="text-align:center;">#</th><th style="text-align:center;">KEY</th><th style="text-align:center;">DAYS</th><th style="text-align:center;">DATE</th></tr></thead>
                        <tbody id="history-tbody"></tbody>
                    </table>
                </div>
                <div id="history-empty" style="text-align:center; padding:30px; color:#4b5563;">No keys generated yet.</div>
                <div class="export-btns" style="margin-top:20px;">
                    <button class="btn-export csv" onclick="exportCSV()" style="width:100%;">
                        <i class="fa-solid fa-file-csv"></i> Download CSV
                    </button>
                </div>
            </div>

            <!-- TRANSACTIONS -->
            <div id="tab-transactions" class="tab-content">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:16px;">
                    <div class="stat-section-header" style="margin-bottom:0;">
                        <i class="fa-solid fa-money-bill-transfer" style="color:#a78bfa; font-size:22px;"></i>
                        <h3 style="color:#e2e8f0; font-size:18px; font-weight:700;">Transaction History</h3>
                    </div>
                    <button class="btn-deposit-main" onclick="openDepositOverlay()">
                        <i class="fa-solid fa-plus"></i> Deposit
                    </button>
                </div>
                <div id="transactions-list"></div>
                <div id="transactions-empty" style="text-align:center; padding:50px 20px;">
                    <div style="width:56px;height:56px;border-radius:50%;background:rgba(139,92,246,0.15);display:flex;align-items:center;justify-content:center;margin:0 auto 20px;">
                        <i class="fa-solid fa-info" style="color:#a78bfa;font-size:24px;"></i>
                    </div>
                    <div style="font-size:16px; font-weight:600; color:#e2e8f0; margin-bottom:8px;">No balance transactions yet</div>
                    <div style="font-size:13px; color:#6b7280; line-height:1.6;">Your balance history will appear here</div>
                </div>
            </div>

            <!-- ADMIN -->
            <div id="tab-admin" class="tab-content">
                <div class="admin-section">
                    <h3><i class="fa-solid fa-users"></i> Users Management</h3>
                    <h4 style="color:#9ca3af; font-size:13px; margin-bottom:10px;">Add New User</h4>
                    <input class="admin-input" id="admin-new-user" placeholder="Username">
                    <input class="admin-input" id="admin-new-pass" placeholder="Password" type="password">
                    <button class="btn-admin green" onclick="adminAddUser()" style="width:100%;">
                        <i class="fa-solid fa-user-plus"></i> Add User
                    </button>
                    <h4 style="color:#9ca3af; font-size:13px; margin-top:16px; margin-bottom:10px;">Delete User</h4>
                    <select class="admin-select" id="admin-delete-user-select"></select>
                    <button class="btn-admin red" onclick="adminDeleteUserFromSelect()" style="width:100%;">
                        <i class="fa-solid fa-trash"></i> Delete User
                    </button>
                    <h4 style="color:#9ca3af; font-size:13px; margin-top:16px; margin-bottom:10px;">Registered Accounts</h4>
                    <div id="admin-accounts-log" style="margin-top:8px;"></div>
                    <div id="admin-users-list" style="margin-top:16px;"></div>
                </div>
                <div class="admin-section">
                    <h3><i class="fa-solid fa-dollar-sign"></i> Balance Management</h3>
                    <select class="admin-select" id="admin-balance-user"></select>
                    <input class="admin-input" id="admin-balance-amount" placeholder="Amount ($)" type="number" step="0.01">
                    <div class="admin-btn-row">
                        <button class="btn-admin green" onclick="adminModifyBalance('add')">
                            <i class="fa-solid fa-plus"></i> Add
                        </button>
                        <button class="btn-admin red" onclick="adminModifyBalance('remove')">
                            <i class="fa-solid fa-minus"></i> Remove
                        </button>
                    </div>
                    <div id="admin-balance-list" style="margin-top:16px;"></div>
                </div>
                <div class="admin-section">
                    <h3><i class="fa-solid fa-box"></i> Products Management</h3>
                    <h4 style="color:#9ca3af; font-size:13px; margin-bottom:10px;">Add New Product</h4>
                    <input class="admin-input" id="admin-prod-name" placeholder="Product Name">
                    <input class="admin-input" id="admin-prod-days" placeholder="Duration (Days)" type="number">
                    <input class="admin-input" id="admin-prod-price" placeholder="Price ($)" type="number" step="0.01">
                    <button class="btn-admin purple" onclick="adminAddProduct()" style="width:100%;">
                        <i class="fa-solid fa-plus"></i> Add Product
                    </button>
                    <h4 style="color:#9ca3af; font-size:13px; margin-top:16px; margin-bottom:10px;">Delete Product</h4>
                    <select class="admin-select" id="admin-delete-product-select"></select>
                    <button class="btn-admin red" onclick="adminDeleteProductFromSelect()" style="width:100%;">
                        <i class="fa-solid fa-trash"></i> Delete Product
                    </button>
                    <h4 style="color:#9ca3af; font-size:13px; margin-top:16px; margin-bottom:10px;">Products Log</h4>
                    <div id="admin-products-list" style="margin-top:8px;"></div>
                </div>
                <div class="admin-section">
                    <h3><i class="fa-solid fa-key"></i> Keys Pool Management</h3>
                    <p style="color:#6b7280; font-size:12px; margin-bottom:12px;">Add pre-generated keys for each product.</p>
                    <select class="admin-select" id="admin-key-product" onchange="renderAdminKeyPool()"></select>
                    <select class="admin-select" id="admin-key-duration"></select>
                    <textarea class="admin-input" id="admin-key-value" placeholder="Enter key (one per line)" rows="3" style="resize:vertical;"></textarea>
                    <button class="btn-admin green" onclick="adminAddKey()" style="width:100%;">
                        <i class="fa-solid fa-plus"></i> Add Key(s)
                    </button>
                    <select class="admin-select" id="admin-delete-key-select" style="margin-top:12px;"></select>
                    <button class="btn-admin red" onclick="adminDeleteKeyFromSelect()" style="width:100%;">
                        <i class="fa-solid fa-trash"></i> Delete Key
                    </button>
                    <div id="admin-key-pool" style="margin-top:12px;"></div>
                </div>

                <!-- DEPOSIT AMOUNTS MANAGEMENT -->
                <div class="admin-section">
                    <h3><i class="fa-solid fa-coins"></i> Deposit Amounts</h3>
                    <p style="color:#6b7280; font-size:12px; margin-bottom:12px;">Set fixed deposit amounts. Users can only deposit these amounts.</p>
                    <div style="display:flex; gap:8px; margin-bottom:12px;">
                        <input class="admin-input" id="admin-deposit-amount-input" placeholder="Amount ($)" type="number" step="0.01" min="0.01" style="margin-bottom:0; flex:1;">
                        <button class="btn-admin green" onclick="adminAddDepositAmount()" style="flex:none; padding:10px 16px;">
                            <i class="fa-solid fa-plus"></i> Add
                        </button>
                    </div>
                    <div id="admin-deposit-amounts-list" style="margin-top:8px;"></div>
                </div>

                <div class="admin-section">
                    <h3><i class="fa-solid fa-shield-halved"></i> IP Blacklist</h3>
                    <input class="admin-input" id="admin-ip-input" placeholder="IP Address">
                    <select class="admin-select" id="admin-ban-duration">
                        <option value="temp-5">Temporary (5 min)</option>
                        <option value="temp-15">Temporary (15 min)</option>
                        <option value="temp-30">Temporary (30 min)</option>
                        <option value="temp-60">Temporary (1 hour)</option>
                        <option value="temp-1440">Temporary (24 hours)</option>
                        <option value="custom">Custom Duration (minutes)</option>
                        <option value="permanent">Permanent</option>
                    </select>
                    <input class="admin-input hidden" id="admin-ban-custom-minutes" placeholder="Duration in minutes" type="number" min="1">
                    <div class="admin-btn-row">
                        <button class="btn-admin red" onclick="adminBanIP()">
                            <i class="fa-solid fa-ban"></i> Block IP
                        </button>
                        <button class="btn-admin green" onclick="adminUnbanIP()">
                            <i class="fa-solid fa-check"></i> Unblock IP
                        </button>
                    </div>
                    <div class="admin-btn-row" style="margin-top:8px;">
                        <button class="btn-admin red" onclick="adminUnbanAll()" style="width:100%;">
                            <i class="fa-solid fa-unlock"></i> Unblock ALL IPs (DB + Memory)
                        </button>
                    </div>
                    <div style="margin-top:6px;">
                        <button class="btn-admin purple" onclick="adminClearMemoryBans()" style="width:100%; font-size:11px;">
                            <i class="fa-solid fa-broom"></i> Clear Memory Bans Only (if DB was cleaned manually)
                        </button>
                    </div>
                    <div id="admin-ip-list" style="margin-top:12px;"></div>
                </div>
                <div class="admin-section">
                    <h3><i class="fa-solid fa-bullhorn"></i> Send Announcement</h3>
                    <p style="color:#6b7280; font-size:12px; margin-bottom:12px;">Send a message to all resellers (appears on login).</p>
                    <textarea class="admin-input" id="admin-announcement-text" placeholder="Enter announcement message..." rows="3" style="resize:vertical;"></textarea>
                    <div class="admin-btn-row">
                        <button class="btn-admin purple" onclick="adminSendAnnouncement()" style="flex:2;">
                            <i class="fa-solid fa-paper-plane"></i> Send Announcement
                        </button>
                        <button class="btn-admin red" onclick="adminClearAnnouncement()">
                            <i class="fa-solid fa-trash"></i> Clear
                        </button>
                    </div>
                    <div id="admin-current-announcement" style="margin-top:12px;"></div>
                </div>
                <div class="admin-section">
                    <h3><i class="fa-solid fa-bell"></i> Telegram Notifications</h3>
                    <p style="color:#6b7280; font-size:12px; margin-bottom:12px;">Test if your Telegram bot notifications are working.</p>
                    <button class="btn-admin green" onclick="testTelegram()" style="width:100%;">
                        <i class="fa-solid fa-paper-plane"></i> Send Test Notification
                    </button>
                    <div id="telegram-test-result" style="margin-top:8px;"></div>
                </div>

                <!-- ADMIN CREDENTIALS CHANGE -->
                <div class="admin-section" style="border: 1px solid rgba(239, 68, 68, 0.3); background: rgba(239, 68, 68, 0.05);">
                    <h3><i class="fa-solid fa-lock"></i> Change Admin Credentials</h3>
                    <p style="color:#6b7280; font-size:12px; margin-bottom:12px;">Change admin login password and/or 2FA code. Requires secret code to apply.</p>
                    <input class="admin-input" id="admin-cred-new-pass" placeholder="New Password (leave empty to keep current)" type="password">
                    <input class="admin-input" id="admin-cred-new-2fa" placeholder="New 2FA Code (leave empty to keep current)" type="text" maxlength="10">
                    <input class="admin-input" id="admin-cred-secret" placeholder="Enter Secret Code to Apply" type="password" style="border-color: rgba(239, 68, 68, 0.4);">
                    <button class="btn-admin red" onclick="adminChangeCredentials()" style="width:100%;">
                        <i class="fa-solid fa-shield-halved"></i> Apply Changes
                    </button>
                    <div id="admin-cred-result" style="margin-top:8px;"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- ANNOUNCEMENT POPUP -->
    <div id="announcement-overlay" class="announcement-overlay hidden">
        <div class="announcement-box">
            <div class="announcement-header">
                <i class="fa-solid fa-bullhorn"></i> Announcement
            </div>
            <div class="announcement-body" id="announcement-body"></div>
            <button class="announcement-close-btn" onclick="closeAnnouncement()">Close</button>
        </div>
    </div>

    <!-- NOTIFICATION BAR -->
    <div id="notify-bar" class="notify-bar">
        <i class="fa-solid fa-ban"></i> Right-click disabled!
    </div>

    <!-- TOAST -->
    <div id="toast" class="toast"></div>

    <!-- MODAL -->
    <div id="modal-overlay" class="modal-overlay hidden" onclick="closeModal()">
        <div class="modal-box" onclick="event.stopPropagation()">
            <div class="modal-icon" id="modal-icon"><i class="fa-solid fa-check-circle"></i></div>
            <div class="modal-title" id="modal-title">Success</div>
            <div class="modal-msg" id="modal-msg">Operation completed.</div>
            <button class="modal-btn" onclick="closeModal()">OK</button>
        </div>
    </div>

    <!-- CONFIRM MODAL -->
    <div id="confirm-overlay" class="modal-overlay hidden" onclick="cancelConfirm()">
        <div class="modal-box" onclick="event.stopPropagation()">
            <div class="modal-icon" style="color: #a78bfa;"><i class="fa-solid fa-key"></i></div>
            <div class="modal-title" id="confirm-title">Confirm Key Generation</div>
            <div class="modal-msg" id="confirm-msg">Are you sure?</div>
            <div style="display: flex; gap: 10px; justify-content: center;">
                <button class="modal-btn" id="confirm-yes-btn" onclick="confirmGenerate()" style="background: linear-gradient(135deg, #10b981, #34d399); flex: 1;">
                    <i class="fa-solid fa-check"></i> Confirm
                </button>
                <button class="modal-btn" onclick="cancelConfirm()" style="background: linear-gradient(135deg, #ef4444, #f87171); flex: 1;">
                    <i class="fa-solid fa-times"></i> Cancel
                </button>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.1/jspdf.plugin.autotable.min.js"></script>
    <script src="data.js"></script>
    <script src="logic.js"></script>

    <!-- DEPOSIT OVERLAY -->
    <div id="deposit-overlay" class="deposit-overlay hidden">
        <div class="deposit-backdrop"></div>
        
        <!-- Step 1: Deposit Form -->
        <div id="deposit-step-form" class="deposit-card">
            <div class="deposit-glow"></div>
            <div class="deposit-header">
                <h2>Deposit Funds</h2>
                <p>Pay via Binance to add balance</p>
            </div>
            
            <div class="deposit-timer-bar">
                <div class="deposit-timer-fill" id="deposit-timer-fill"></div>
            </div>
            <div class="deposit-timer-text">
                <i class="fa-solid fa-clock"></i>
                <span id="deposit-timer-label">05:00</span>
            </div>
            
            <div class="deposit-qr-section">
                <div class="deposit-qr-frame">
                    <a href="/binance-qr.png" download="Binance-QR-Code.png" id="qr-download-link">
                        <img src="/binance-qr.png" alt="Binance QR Code" class="deposit-qr-img" id="deposit-qr-image">
                    </a>
                </div>
                <div style="margin-top:8px;">
                    <button onclick="downloadQRCode()" class="deposit-qr-download-btn">
                        <i class="fa-solid fa-download"></i> Download QR
                    </button>
                </div>
                <div class="deposit-binance-id">
                    <span class="deposit-id-label">Binance ID</span>
                    <div class="deposit-id-value" onclick="copyBinanceId()">
                        <span>1184166252</span>
                        <i class="fa-solid fa-copy"></i>
                    </div>
                </div>
            </div>
            
            <!-- Fixed Amount Selection -->
            <div class="deposit-amount-section">
                <label class="deposit-label">Select Amount (USD)</label>
                <div id="deposit-amounts-grid" class="deposit-amounts-grid">
                    <!-- Filled by JS -->
                </div>
                <input type="hidden" id="deposit-amount-input" value="">
            </div>
            
            <div class="deposit-actions">
                <button class="deposit-btn-confirm" id="deposit-btn-confirm" onclick="confirmDeposit()">
                    <i class="fa-solid fa-check-circle"></i> Confirm Payment
                </button>
                <button class="deposit-btn-cancel" onclick="cancelDeposit()">
                    <i class="fa-solid fa-times"></i> Cancel
                </button>
            </div>
        </div>
        
        <!-- Step 2: Waiting for Admin -->
        <div id="deposit-step-waiting" class="deposit-card hidden">
            <div class="deposit-glow"></div>
            <div class="deposit-header">
                <h2>Request Submitted</h2>
                <p>Your deposit request has been sent to the admin</p>
            </div>
            
            <div class="deposit-waiting-info">
                <div class="deposit-waiting-amount">
                    <span class="deposit-waiting-label">Amount</span>
                    <span class="deposit-waiting-value" id="deposit-waiting-amount-text">$0.00</span>
                </div>
                <div class="deposit-waiting-status">
                    <div class="deposit-status-dot"></div>
                    <span>Pending admin approval</span>
                </div>
                <p class="deposit-waiting-note">
                    The admin has been notified. Your balance will be updated once the payment is verified. You can submit a new request after 3 hours.
                </p>
            </div>
            
            <button class="deposit-btn-confirm" onclick="closeDepositOverlay()" style="margin-top: 20px;">
                <i class="fa-solid fa-arrow-left"></i> Back to Transactions
            </button>
        </div>
    </div>

    <script>
    /* ===== SESSION PERSISTENCE ===== */
    (function() {
        const SAVED_TAB_KEY = 'userRestoredTab';
        window.addEventListener('beforeunload', function() {
            var activeTab = document.querySelector('.tab-content.active');
            if (activeTab && activeTab.id) {
                sessionStorage.setItem(SAVED_TAB_KEY, activeTab.id);
            }
        });
        window.restoreUserViewState = function() {
            var savedTab = sessionStorage.getItem(SAVED_TAB_KEY);
            if (savedTab) {
                var targetTab = document.getElementById(savedTab);
                if (targetTab && targetTab.classList.contains('tab-content')) {
                    document.querySelectorAll('.tab-content').forEach(function(t) { t.classList.remove('active'); });
                    targetTab.classList.add('active');
                    document.querySelectorAll('.nav-item').forEach(function(n) { n.classList.remove('active'); });
                    var navItem = document.querySelector('[onclick*="' + savedTab + '"]');
                    if (navItem) navItem.classList.add('active');
                }
            }
        };
    })();
    </script>
</body>
</html>
